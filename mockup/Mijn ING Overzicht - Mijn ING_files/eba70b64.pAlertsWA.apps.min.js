/*! Built by spectINGular on 15-03-2016 07:42:04 for restricted.*/
angular.module("pAlertsWAApp",["ingGlobal","ngResource","ngSanitize","ngCookies"]).config(["propertyServiceProvider",function(a){"use strict";a.add("pAlertsWAApp",{emptyInboxMessage:"Er zijn geen berichten.",unreadMessageTitle:"Bericht markeren als ongelezen",saveMessageTitle:"Bericht opslaan als PDF document",printMessageTitle:"Bericht openen in een nieuw venster",confirmDeleteDialogTitle:"Bericht verwijderen",confirmDeleteDialogMessage:"Weet u zeker dat u dit bericht wilt verwijderen? Een verwijderd bericht kunt u niet meer terughalen.",errorNoData:"Sorry, er gaat iets fout. Probeer het later nog een keer. Excuses voor het ongemak.",errorTechnical:"Sorry, er gaat iets fout. Probeer het later nog een keer. Excuses voor het ongemak.",errorNoInboxFound:'U ontvangt uw berichten over uw bankzaken per post. Wilt u de berichten voortaan in Mijn ING ontvangen? <a href="/particulier/ik-en-ing/index">Regel het eenvoudig</a>',errorNotFound:"Het bericht is niet gevonden. Mogelijk is het bericht verwijderd."})}]),angular.module("pAlertsWAApp").controller("inboxController",["$scope","$rootScope","$sce","propertyService","businessMonitoringService","convertLinksFilter","addBusinessMonitoringEventFilter","HalMessagesService","unreadMessageCountSender",function(a,b,c,d,e,f,g,h,i){"use strict";function j(b){a.errorGetInbox=void 0,a.countUnreadMessages=parseInt(b.unreadMessages,10),a.countImportantUnreadMessages=parseInt(b.importantUnreadMessages,10),a.countTotalMessages=a.countUnreadMessages+parseInt(b.readMessages,10),a.page=b.page,a.countTotalMessages>0&&(a.messageHeaders=b.messageHeaders,a.initial&&a.getMessage(a.messageHeaders[0])),a.initial=!1}function k(b){404===b.status?(a.errorGetInbox=r.errorNoInboxFound,a.infoType=!0):a.errorGetInbox=r.errorNoData}function l(){a.errorGetMessage=r.errorTechnical}function m(b){"READ"!==b.status&&h.setRead(b).then(function(c){b.status="READ",a.countUnreadMessages--,b.important&&a.countImportantUnreadMessages--,i(a.countUnreadMessages,a.countImportantUnreadMessages>0)},l)}function n(b){for(var c=0;c<a.messageHeaders.length;c++)a.messageHeaders[c].selected=!1;b.selected=!0}function o(a){var b=a.content;b||(b=""),b=b.replace(/\s\s+/g," "),b=f(b),b=g(b),a.messageText=b}function p(b){a.message=b,a.showMessage=!0,n(b),m(b)}function q(){h.getMessages().then(j,k)}var r=d.properties("pAlertsWAApp");a.showMessage=!1,a.properties=r,a.errorGetInbox=void 0,a.errorGetMessage=void 0,a.infoType=!1,a.countTotalMessages=null,a.countUnreadMessages=null,a.countImportantUnreadMessages=null,a.messageHeaders=[],a.initial=!0,a.monitoringParams=null,a.page={start:0,first:!0,last:!1},a.showNextPage=function(){a.page.last||h.nextPage().then(j,k)},a.showPreviousPage=function(){return a.page.first?void 0:h.prevPage().then(j,k)},a.reloadPage=function(){return h.reloadPage().then(j,k)},a.getMessage=function(b){return angular.isDefined(b.messageText)?void p(b):void h.getMessage(b).then(function(c){a.errorGetMessage=void 0,angular.extend(b,c),angular.extend(b._links,c._links),o(b),p(b)},l)},a.deleteMessage=function(b){h.deleteMessage(b).then(function(){var c=-1;angular.forEach(a.messageHeaders,function(a,d){a===b&&(c=d)}),a.messageHeaders.splice(c,1),0===a.messageHeaders.length&&a.page.last&&!a.page.first?a.showPreviousPage().then(function(){a.messageHeaders.length>0&&a.getMessage(a.messageHeaders[a.messageHeaders.length-1])}):a.reloadPage().then(function(){c>=0&&c<a.messageHeaders.length&&a.getMessage(a.messageHeaders[c])}),a.closeDialog()},l)},a.unreadMessage=function(b){"READ"===b.status&&h.setUnread(b).then(function(c){b.status="UNREAD",b.important&&a.countImportantUnreadMessages++,a.countUnreadMessages++,i(a.countUnreadMessages,a.countImportantUnreadMessages>0)},l)},a.print=function(b){a.businessMonitoringPrint(),h.print(b)},a.businessMonitoringLink=function(b){var c=b.target||b.srcElement;a.monitoringParams={},a.monitoringParams.formextra1=a.message.id,a.monitoringParams.formextra2=c.attributes.href.nodeValue,e.sendMonitoringEvent(a.monitoringParams)},a.businessMonitoringSavePDF=function(){a.monitoringParams={},a.monitoringParams.formextra1=a.message.id,a.monitoringParams.events="event57",e.sendMonitoringEvent(a.monitoringParams)},a.businessMonitoringPrint=function(){a.monitoringParams={},a.monitoringParams.formextra1=a.message.id,a.monitoringParams.events="event56",e.sendMonitoringEvent(a.monitoringParams)},a.to_trusted=function(a){return c.trustAsHtml(a)},a.closeDialog=function(){a.$broadcast("modal-close")},q()}]),angular.module("pAlertsWAApp").controller("workbenchController",["$scope","$cookies","HalMessagesService","unreadMessageCountListener",function(a,b,c,d){"use strict";function e(b){if("undefined"===b||0===b.length)return void(a.errorWorkbench=!0);if(a.countUnreadMessages=parseInt(b.unreadMessages,10),a.countImportantUnreadMessages=parseInt(b.importantUnreadMessages,10),a.countImportantUnreadMessages>0&&a.importantMessageNotification&&(a.importantUnreadMessages=!0),a.importantUnreadMessages&&a.smallLayout){var c=$("#dpc-important-messages");c.hide(),c.css("position","absolute"),c.children(".arrow").css("left","20px").css("right","auto"),c.fadeIn(300).delay(5e3).fadeOut(300)}}function f(b){a.throwError(b,"errorWorkbench",!0)}a.errorWorkbench=!1,a.countUnreadMessages=null,a.countImportantUnreadMessages=null,a.importantUnreadMessages=!1,a.smallLayout=$("html").hasClass("small"),a.getUnreadMessages=function(){a.importantMessageNotification=b.importantMessageNotificationRemoved?!1:!0,c.getMessageCounts().then(e,f)},d(function(b,c,d){a.countUnreadMessages=c,d===!1&&(a.importantUnreadMessages=!1)}),a.closeImportantMessages=function(){a.importantUnreadMessages=!1,a.setCookie()},a.setCookie=function(){b.importantMessageNotificationRemoved="true"},a.throwError=function(b,c,d){0!==b.status&&(a[c]=d)}}]),angular.module("pAlertsWAApp").directive("attachmentsOverview",function(){"use strict";return{restrict:"E",scope:{attachments:"="},controller:"attachmentOverviewCtrl",template:'<div ng-repeat="attachment in attachments"><span class="icon icon-orange icon-attachment"> </span><a class="h-cursor-pointer" ng-click="download(attachment)">{{attachment.name}}</a>{{attachment.size | prettyBytes}}</div>'}}).controller("attachmentOverviewCtrl",["$scope","HalMessagesService",function(a,b){"use strict";a.download=function(a){b.download(a)}}]),angular.module("pAlertsWAApp").directive("updateWorkbenchCounter",function(){"use strict";return function(a){a.$watch("countUnreadMessages",function(a){$(".riaf-alerting-messages-number",document).text(a?"("+a+")":"")})}}).directive("hideRiafHeaderPagetitle",function(){"use strict";return function(){$("#riaf-header-pagetitle").hide()}}).directive("compileMessageText",["$compile",function(a){"use strict";return{restrict:"A",replace:!0,link:function(b,c,d){b.$watch(d.compileMessageText,function(d){c.html(d),a(c.contents())(b)})}}}]).directive("preventWheelScroll",function(){"use strict";return{restrict:"A",link:function(a,b){b.on("mousewheel wheel",function(a){a.stopImmediatePropagation()})}}}),angular.module("pAlertsWAApp").filter("addBusinessMonitoringEvent",function(){"use strict";return function(a){return a&&a.replace(/<a (href=["'][^#])/g,'<a ng-click="businessMonitoringLink($event)" $1')}}),angular.module("pAlertsWAApp").filter("convertLinks",["propertyService",function(a){"use strict";var b=a.properties("pAlertsWAApp"),c=/(href=['"])#([A-Za-z0-9:%_.\-$\^#@!()]*)/g,d=/target=['"].*?['"]\s?/g;return function(a){return a&&a.replace(d,"").replace(c,function(a,c,d){function e(a){return a&&0===a.search("http")&&-1===a.search("mijn.ing.nl")}var f=b[d];return f||(f="#"+d),e(f)?"target='_blank' "+c+f:c+f})}}]),angular.module("pAlertsWAApp").filter("dateWithAgo",["dateParser",function(a){"use strict";function b(a){return 1===a?" (1 dag geleden)":a>0&&31>a?" ("+a+" dagen geleden)":""}return function(c,d){if(!c)return"";var e=a.parseDateTimeString(c),f=e.getDate(),g=a.getMonthName(e.getMonth()),h=e.getFullYear(),i=a.calculateDaysAgo(e,d);return f+" "+g+" "+h+b(i)}}]),angular.module("pAlertsWAApp").filter("prettyBytes",function(){"use strict";return function(a){var b=" (",c=")",d=1e3,e=parseFloat(a);if(isNaN(e)||0>e)return"";if(0===e)return b+e+" bytes"+c;if(1===e)return b+e+" byte"+c;var f=["bytes","kB","MB","GB"],g=[0,1,1,1,1,1],h=Math.floor(Math.log(e)/Math.log(d)),i=g[h],j=(e/Math.pow(d,h)).toFixed(i);return 1e3===parseInt(j,10)&&(j="1.0",h++),h>=f.length?"":b+j.replace(".",",")+" "+f[h]+c}}),angular.module("pAlertsWAApp").filter("prettyDate",["dateParser",function(a){"use strict";return function(b,c){if(!b)return"";var d=a.parseDateTimeString(b),e=a.calculateDaysAgo(d,c);if(0===e){var f=d.getHours(),g=d.getMinutes();return(10>f?"0":"")+f+":"+(10>g?"0":"")+g}if(1===e)return"gisteren";if(7>e)return a.getWeekDayName(d.getDay());var h=d.getDate(),i=d.getMonth()+1,j=d.getFullYear();return h+"-"+i+"-"+j}}]),angular.module("pAlertsWAApp").service("businessMonitoringService",function(){"use strict";this.sendMonitoringEvent=function(a){"undefined"!=typeof s&&(a&&(a.formextra1&&(s.formextra1=a.formextra1),a.formextra2&&(s.formextra2=a.formextra2),a.formextra3&&(s.formextra3=a.formextra3),a.formextra4&&(s.formextra4=a.formextra4),a.events&&(s.events=a.events)),s.pageEvent())}}),angular.module("pAlertsWAApp").service("dateParser",function(){"use strict";var a=864e5;this.parseDateTimeString=function(a){if(!a)return void 0;var b=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(\.\d+)?Z$/,c=a.match(b);if(!c)return void 0;var d=c[1],e=c[2]-1,f=c[3],g=c[4],h=c[5],i=c[6],j=c[7]?(c[7]+"000").substr(1,3):0;return new Date(Date.UTC(d,e,f,g,h,i,j))},this.getWeekDayName=function(a){var b=["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"];return b[a]},this.getMonthName=function(a){var b=["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"];return b[a]},this.removeTime=function(a){a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)},this.calculateDaysAgo=function(b,c){var d=new Date(b);this.removeTime(d);var e=c?new Date(c):new Date;this.removeTime(e);var f=e-d,g=f/a;return Math.round(g)}}),angular.module("pAlertsWAApp").service("HalMessagesService",["$http","$q","$window",function(a,b,c){"use strict";function d(a,b){return t+a._links[b].href}function e(c){var d=b.defer();return a.get(c,r).then(function(a){var b=a.data;v=q(b),b._embedded&&(b.messageHeaders=b._embedded.messages),b.page&&(b.page.first=v.isFirstPage(),b.page.last=v.isLastPage()),d.resolve(b)},function(a){d.reject(a)}),d.promise}function f(){var c=u+"?limit=0",d=b.defer();return a.get(c,r).then(function(a){var b=a.data;d.resolve(b)},function(a){d.reject(a)}),d.promise}function g(){return e(u)}function h(c){var e=b.defer();return a.get(d(c,"self"),r).then(function(a){var b=a.data;b.downloadLink=d(c,"download"),angular.isDefined(b._embedded)&&(b.attachments=b._embedded.attachments),e.resolve(b)},function(a){e.reject(a)}),e.promise}function i(a){c.open(d(a,"download"))}function j(a){c.open(d(a,"print"))}function k(){return e(t+v.next())}function l(){return e(t+v.prev())}function m(){return e(t+v.self())}function n(b){return a.post(d(b,"read"),s)}function o(b){return a.post(d(b,"unread"),s)}function p(b){return a["delete"](d(b,"self"),s)}function q(a){function b(a,b){return a[b].href}function c(){return b(j,"self")}function d(){return b(j,"first")}function e(){return b(j,"prev")}function f(){return b(j,"next")}function g(){return b(j,"last")}function h(){var a=d(),b=c();return angular.isDefined(b)&&a===b}function i(){var a=g(),b=c();return angular.isDefined(b)&&a===b}var j=a._links;return{self:c,first:d,prev:e,next:f,last:g,isFirstPage:h,isLastPage:i}}var r={headers:{Accept:"application/hal+json"}},s={headers:{Accept:"text/plain"}},t="/api/customerinbox",u=t+"/messages",v={};return{getMessageCounts:f,getMessages:g,getMessage:h,download:i,print:j,setRead:n,setUnread:o,deleteMessage:p,nextPage:k,prevPage:l,reloadPage:m}}]),angular.module("pAlertsWAApp").factory("unreadMessageCountSender",function(){"use strict";return function(a,b){$(document).triggerHandler("alertCountUpdate",[a,b])}}).factory("unreadMessageCountListener",function(){"use strict";return function(a){$(document).bind("alertCountUpdate",a)}}),angular.module("ingGlobal").run(["$templateCache",function(a){"use strict";a.put("pAlertsWA/app/partials/palertswa-confirm.html",'<div class="panel panel-a panel-radius"><div class="panel-heading"><h3 class="panel-title panel-title-primary">{{properties.confirmDeleteDialogTitle}}</h3></div><div class="panel-body"><p>{{properties.confirmDeleteDialogMessage}}</p></div><div class="panel-footer"><button type="button" ng-click="deleteMessage(message)" class="btn btn-primary">Verwijderen</button> <a ng-click="closeDialog()" class="close close-c close-float-right h-cursor-pointer">Annuleren</a></div></div>'),a.put("pAlertsWA/app/partials/palertswa-index.html",'<div id="palertswa" ng-cloak class="ng-cloak tg" ng-controller="inboxController" update-workbench-counter><h1 hide-riaf-header-pagetitle class="riaf-header-pagetitle rockwell">Berichten <span ng-cloak ng-show="countUnreadMessages > 0">({{countUnreadMessages}} ongelezen)</span></h1><div class="panel panel-bordered" ng-cloak ng-show="!initial"><div class="panel-body panel-bg-mig-a-messages l-p-0"><div class="row"><!-- messages list column --><div class="col-lg-3"><!-- error notification --><div ng-show="errorGetInbox && !initial" ng-cloak><div ing-notification type="error"><strong>{{errorGetInbox}}</strong></div></div><!-- end error --><div ng-hide="errorGetInbox"><ol class="list-group-messages list-group list-group-sm list-group-mig-a" role="listbox"><!-- list header(current page|total) --><li class="l-p-1 list-group-item"><div class="row"><div class="col-lg-7" ng-show="countTotalMessages > 0">Bericht <b>{{page.start + 1}} - {{page.start + messageHeaders.length}}</b></div><div class="col-lg-5 h-text-right">Totaal <b>{{countTotalMessages}}</b></div></div></li><!-- end list header --><!-- message headers --><li role="option" ng-repeat="message in messageHeaders" class="list-group-item" ng-class="{active : message.selected}" ng-click="getMessage(message)" ng-cloak><a href="#"><span ng-class="{\'not-read\': message.status === \'UNREAD\'}"><span class="list-group-item-additives">{{message.sendDateTime | prettyDate}} <span class="list-group-item-icons"><i ng-show="message.hasAttachment" class="icon icon-attachment" aria-hidden="true"></i> <i ng-show="message.important" class="icon icon-exclamationmark" aria-hidden="true"></i></span></span><div ng-bind-html="to_trusted(message.subject)"></div></span></a></li><!-- end message headers --><!-- scroll buttons --><li class="list-group-item"><div class="row-table"><div class="row-table-table"><div class="col-lg-10"></div><div class="col-lg-2"><div><button type="button" class="btn btn-transparent l-pb-0" ng-class="{disabled: page.first}" ng-click="showPreviousPage()"><i aria-hidden="true" class="icon icon-arrow-g-up icon-xxl"></i></button></div><div><button type="button" class="btn btn-transparent l-pt-0" ng-class="{disabled: page.last}" ng-click="showNextPage()"><i aria-hidden="true" class="icon icon-arrow-g-down icon-xxl"></i></button></div></div></div></div></li><!-- end scroll buttons --></ol></div></div><!-- end messages list --><div ng-switch="countTotalMessages" class="col-lg-9"><div ng-switch-when="0" class="h-text-center l-pt-5 l-pr-2 l-pb-2 l-pl-2"><div class="">{{properties.emptyInboxMessage}}</div><div class="l-pt-4 l-pb-4"><img src="/static/web/ngtg/img/palertswa-empty-icon.png"></div></div><div ng-switch-default class="l-pr-3 l-pl-5 l-mt-1"><div class="btn-toolbar h-text-right" role="toolbar"><div class="btn-group" ng-hide="errorGetMessage || !showMessage"><a class="btn btn-default btn-sm icon-position icon-before icon-position-sm" ng-click="unreadMessage(message)" title="{{properties.unreadMessageTitle}}">Markeren als ongelezen <i aria-hidden="true" class="icon icon-document icon-orange"></i></a> <a class="btn btn-default btn-sm icon-position icon-before icon-position-sm" ng-href="{{message.downloadLink}}" ng-click="businessMonitoringSavePDF()" title="{{properties.saveMessageTitle}}">Opslaan als PDF <i aria-hidden="true" class="icon icon-pdf icon-orange"></i></a> <a class="btn btn-default btn-sm icon-position icon-before icon-position-sm" ng-click="print(message)" target="_blank" title="{{properties.printMessageTitle}}">Printen <span class="stacked-icon icon-jb"><i class="icon icon-print-z1 icon-orange" aria-hidden="true"></i> <i class="icon icon-print-z2 icon-white" aria-hidden="true"></i></span></a> <a class="btn btn-default btn-sm icon-position icon-before icon-position-sm" ing-modal partial="pAlertsWA/app/partials/palertswa-confirm.html" size="md">Verwijderen <i aria-hidden="true" class="icon icon-trashcan icon-orange"></i></a></div></div><div class="panel panel-shadow-a"><!--<div class="panel-body alerts-mig-table">--><div class="panel-body plain-markup"><div ng-hide="errorGetMessage || (countTotalMessages == 0) || !showMessage" ng-cloak><h2 class="heading-b-md" ng-bind-html="to_trusted(message.subject)"></h2><div class="h-text-muted">{{message.sendDateTime | dateWithAgo}}</div><attachments-overview attachments="message.attachments"></attachments-overview><hr><div compile-message-text="message.messageText"></div></div><!-- error notification --><div ng-show="errorGetMessage" ng-cloak><div ing-notification type="error"><strong>{{errorGetMessage}}</strong></div></div><!-- end error --></div></div></div></div></div></div></div><!-- error notification --><div ng-show="errorGetInbox && initial" ng-cloak><div ng-show="!infoType"><div ing-notification type="error"><strong ng-bind-html="errorGetInbox"></strong></div></div><div ng-show="infoType"><div ing-notification type="info"><div ng-bind-html="errorGetInbox"></div></div></div></div><!-- end error --></div>'),a.put("pAlertsWA/app/partials/palertswa-workbench.html",'<div id="palertswa-workbench" ng-cloak class="ng-cloak tg" ng-class="{unreadMessages: countUnreadMessages > 0}" ng-controller="workbenchController"><div ng-init="getUnreadMessages()"><a href="/particulier/berichten/index" class="arial-b-lg h-text-f"><i class="icon icon-email" aria-hidden="true"></i> <span class="font-size-sm l-rt-1">Berichten</span> <span class="h-bg-l-a h-text-b l-ml-1 l-pl-05 l-pr-05 panel-radius font-size-sm l-rt-1" ng-cloak ng-show="countUnreadMessages > 0 && errorWorkbench == false">{{countUnreadMessages}}</span></a></div><div id="dpc-important-messages" class="panel panel-a panel-radius panel-shadow-b arrow-container arrow-sm l-mt-1" ng-show="importantUnreadMessages" ng-cloak><div class="arrow arrow-bordered arrow-up"></div><div class="panel-body l-mb-1"><div class="close-wrapper l-mb-1"><button ng-click="closeImportantMessages()" class="close close-default close-float-right"><span class="sr-only">Close</span> <i class="icon" aria-hidden="true"></i></button></div><p>U heeft een belangrijk ongelezen bericht. Bekijk het bericht met een uitroepteken.</p><a href="/particulier/berichten/index" class="riaf-link-correction">Naar uw berichten</a></div></div></div>')}]);